{% extends 'board/base.html' %}
{% load staticfiles %}

{% block script %}
<script>
    $(document).ready(function () {
        due_date_chk()

        $("#id_due_chk").click(function () {
            due_date_chk()
        });

        $("#cancel_btn").click(function () {
            cancel_btn()
        })

    })

    // 마감기한 체크 하면, 입력할 수 있도록 변경
    function due_date_chk() {
        if ($("#id_due_chk").is(":checked")) {
            $("#id_due_date").attr('disabled', false)
        } else {
            $("#id_due_date").val('')
            $("#id_due_date").attr('disabled', true)
        }
    }

    // 저장버튼 눌렀을 때, 체크
    function is_valid_save() {
        if ($("#id_due_chk").is(":checked") && $("#id_due_date").val() == "") {
            alert('마감 기한을 입력해주십시오.')
            return false;
        }
        return true;
    }

    // 뒤로가기 버튼
    function cancel_btn() {
        var param = document.location.href.split("/");

        if (param[3] == "new") {
            location.href = "{% url 'board:post_list' %}"
        } else {
            var url = "{% url 'board:post_detail' 'id' %}".replace('id', param[3])
            location.href = url
        }
    }

    // datepicker
    $(function () {
        $("#id_due_date").datepicker({ format: 'yyyy-mm-dd' });
    });
</script>
{% endblock %}

{% block content %}
<!-- form 항목 -->
<div class="todo">
<form method="POST" class="post-form">{% csrf_token %}
    <div id="todo_table">
        <div class="todo_row">
                <span class="todo_cell col1">제목</span><span class="todo_cell col2">{{form.title}}</span>
        </div>
        <div class="todo_row">
                <span id="todo_content" class="todo_cell col1">내용</span><span id="todo_content" class="todo_cell col2">{{form.text}}</span>
        </div>
        <!-- 유효성 체크 후, 에러발생시 메세지 보여줌 -->
        {{ form.non_field_errors }}
        <div class="todo_row">
                <span class="todo_cell col1">마감 기한</span>
                <span class="todo_cell col2">{{form.due_chk}}{{form.due_date}}</span>
        </div>
        <!-- 항목 추가시에는 완료 여부 보이지 않도록 한다. -->
        {% if form.title.value != None %}
        <div class="todo_row">
                <span class="todo_cell col1">완료 여부</span>
                <span class="todo_cell col2">{{form.complete_chk}}</span>
        </div>
        {% endif %}
    </div>

    <div class="btn_group">
    <input type="button" id="cancel_btn" class="btn" value="취소" />
    <input type="submit" id="save_btn" class="btn" onclick="return is_valid_save()" value="저장" />
    </div>
</form>
</div>  
{% endblock %}